<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>99 Nights in the Forest</title>
  <style>
    /* ===== GLOBAL RESET ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
      color: #fff;
      overflow: hidden;
      pointer-events: none;
      user-select: none;
      -webkit-user-select: none;
    }

    /* ===== UTILITY CLASSES ===== */
    .hidden {
      display: none !important;
    }

    .pointer-events {
      pointer-events: auto;
    }

    /* ===== CROSSHAIR ===== */
    #crosshair {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 20px;
      height: 20px;
      pointer-events: none;
      z-index: 100;
    }

    #crosshair::before,
    #crosshair::after {
      content: '';
      position: absolute;
      background: rgba(255, 255, 255, 0.7);
    }

    #crosshair::before {
      width: 2px;
      height: 100%;
      left: 50%;
      transform: translateX(-50%);
    }

    #crosshair::after {
      width: 100%;
      height: 2px;
      top: 50%;
      transform: translateY(-50%);
    }

    /* ===== TOP-LEFT HUD ===== */
    #hud-top-left {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 10;
    }

    .stat-bar {
      margin-bottom: 12px;
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.85), rgba(20, 20, 20, 0.85));
      padding: 10px 14px;
      border-radius: 8px;
      border: 2px solid rgba(255, 255, 255, 0.15);
      min-width: 280px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }

    .stat-label {
      font-size: 11px;
      color: #bbb;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .stat-value {
      font-size: 13px;
      color: #fff;
      font-weight: bold;
    }

    .bar-container {
      width: 100%;
      height: 22px;
      background: rgba(0, 0, 0, 0.6);
      border-radius: 4px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
    }

    .bar-fill {
      height: 100%;
      transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      position: relative;
      overflow: hidden;
    }

    .bar-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 50%;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.3), transparent);
    }

    .health-bar {
      background: linear-gradient(90deg, #c41e3a, #ff3547);
      box-shadow: inset 0 2px 8px rgba(255, 255, 255, 0.2);
    }

    .stamina-bar {
      background: linear-gradient(90deg, #1565c0, #42a5f5);
      box-shadow: inset 0 2px 8px rgba(255, 255, 255, 0.2);
    }

    .xp-bar {
      background: linear-gradient(90deg, #f57c00, #ffb74d);
      color: #000;
      box-shadow: inset 0 2px 8px rgba(255, 255, 255, 0.2);
    }

    /* ===== TOP-RIGHT GAME INFO ===== */
    #game-info {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.85), rgba(20, 20, 20, 0.85));
      padding: 14px 18px;
      border-radius: 8px;
      border: 2px solid rgba(255, 255, 255, 0.15);
      text-align: right;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      z-index: 10;
      min-width: 200px;
    }

    .info-line {
      font-size: 15px;
      margin-bottom: 8px;
      color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .info-line:last-child {
      margin-bottom: 0;
    }

    .info-label {
      color: #aaa;
      margin-right: 12px;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .info-value {
      color: #ffd700;
      font-weight: bold;
      font-size: 16px;
    }

    .night-indicator {
      font-size: 24px;
      font-weight: bold;
      color: #fff;
      text-align: center;
      margin-bottom: 8px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .night-number {
      color: #ffd700;
      font-size: 28px;
    }

    /* ===== HOTBAR ===== */
    #hotbar {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
      z-index: 10;
    }

    .hotbar-slot {
      width: 64px;
      height: 64px;
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.85), rgba(30, 30, 30, 0.85));
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      transition: all 0.2s ease;
    }

    .hotbar-slot.active {
      border-color: #ffd700;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
      transform: scale(1.1);
    }

    .hotbar-slot.has-item {
      border-color: rgba(100, 200, 255, 0.5);
    }

    .hotbar-number {
      position: absolute;
      top: 4px;
      left: 6px;
      font-size: 10px;
      color: #888;
      font-weight: bold;
    }

    .hotbar-icon {
      font-size: 28px;
      margin-bottom: 2px;
    }

    .hotbar-quantity {
      position: absolute;
      bottom: 4px;
      right: 6px;
      font-size: 11px;
      font-weight: bold;
      color: #fff;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    }

    .hotbar-name {
      font-size: 9px;
      color: #aaa;
      text-align: center;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* ===== NOTIFICATIONS ===== */
    #notifications {
      position: fixed;
      top: 100px;
      right: 20px;
      z-index: 200;
      max-width: 350px;
    }

    .notification {
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(30, 30, 30, 0.95));
      padding: 14px 18px;
      margin-bottom: 12px;
      border-radius: 8px;
      border-left: 4px solid #4caf50;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(8px);
      animation: slideIn 0.3s ease-out;
      position: relative;
      overflow: hidden;
    }

    .notification::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    }

    .notification.info { border-left-color: #2196f3; }
    .notification.success { border-left-color: #4caf50; }
    .notification.warning { border-left-color: #ff9800; }
    .notification.error { border-left-color: #f44336; }
    .notification.boss { border-left-color: #9c27b0; }

    .notification-title {
      font-weight: bold;
      font-size: 14px;
      margin-bottom: 4px;
      color: #fff;
    }

    .notification-message {
      font-size: 13px;
      color: #ccc;
      line-height: 1.4;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOut {
      to {
        transform: translateX(400px);
        opacity: 0;
      }
    }

    /* ===== INVENTORY PANEL ===== */
    #inventory-panel {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, rgba(20, 20, 20, 0.98), rgba(10, 10, 10, 0.98));
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      padding: 24px;
      z-index: 1000;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      min-width: 600px;
      max-width: 90vw;
      max-height: 90vh;
      overflow-y: auto;
    }

    .inventory-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }

    .inventory-title {
      font-size: 24px;
      font-weight: bold;
      color: #ffd700;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .inventory-close {
      background: rgba(255, 0, 0, 0.3);
      border: 2px solid rgba(255, 0, 0, 0.5);
      color: #fff;
      font-size: 20px;
      font-weight: bold;
      width: 32px;
      height: 32px;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .inventory-close:hover {
      background: rgba(255, 0, 0, 0.5);
      transform: scale(1.1);
    }

    .inventory-grid {
      display: grid;
      grid-template-columns: repeat(6, 80px);
      gap: 8px;
      margin-bottom: 20px;
    }

    .inventory-slot {
      width: 80px;
      height: 80px;
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      transition: all 0.2s;
      cursor: pointer;
    }

    .inventory-slot:hover {
      border-color: rgba(255, 215, 0, 0.6);
      background: rgba(255, 215, 0, 0.1);
      transform: scale(1.05);
    }

    .inventory-slot.has-item {
      border-color: rgba(100, 200, 255, 0.4);
    }

    .inventory-slot-icon {
      font-size: 32px;
      margin-bottom: 4px;
    }

    .inventory-slot-name {
      font-size: 9px;
      color: #ccc;
      text-align: center;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      padding: 0 2px;
    }

    .inventory-slot-quantity {
      position: absolute;
      bottom: 6px;
      right: 8px;
      font-size: 12px;
      font-weight: bold;
      color: #fff;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    }

    /* ===== CRAFTING PANEL ===== */
    #crafting-panel {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, rgba(20, 20, 20, 0.98), rgba(10, 10, 10, 0.98));
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      padding: 24px;
      z-index: 1000;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      min-width: 700px;
      max-width: 90vw;
      max-height: 90vh;
      overflow-y: auto;
    }

    .crafting-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }

    .crafting-title {
      font-size: 24px;
      font-weight: bold;
      color: #ff9800;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .crafting-close {
      background: rgba(255, 0, 0, 0.3);
      border: 2px solid rgba(255, 0, 0, 0.5);
      color: #fff;
      font-size: 20px;
      font-weight: bold;
      width: 32px;
      height: 32px;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .crafting-close:hover {
      background: rgba(255, 0, 0, 0.5);
      transform: scale(1.1);
    }

    .recipe-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .recipe-item {
      background: rgba(0, 0, 0, 0.4);
      border: 2px solid rgba(255, 255, 255, 0.15);
      border-radius: 8px;
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 16px;
      transition: all 0.2s;
      cursor: pointer;
    }

    .recipe-item:hover {
      border-color: rgba(255, 152, 0, 0.6);
      background: rgba(255, 152, 0, 0.1);
      transform: translateX(4px);
    }

    .recipe-item.craftable {
      border-color: rgba(76, 175, 80, 0.5);
    }

    .recipe-item.craftable:hover {
      border-color: rgba(76, 175, 80, 0.8);
      background: rgba(76, 175, 80, 0.15);
    }

    .recipe-icon {
      font-size: 40px;
      min-width: 50px;
      text-align: center;
    }

    .recipe-info {
      flex: 1;
    }

    .recipe-name {
      font-size: 16px;
      font-weight: bold;
      color: #fff;
      margin-bottom: 6px;
    }

    .recipe-requirements {
      font-size: 12px;
      color: #aaa;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .requirement {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .requirement.missing {
      color: #f44336;
    }

    .requirement.has {
      color: #4caf50;
    }

    .recipe-craft-btn {
      background: linear-gradient(135deg, #ff9800, #f57c00);
      border: 2px solid #ff9800;
      color: #fff;
      padding: 10px 24px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 12px;
    }

    .recipe-craft-btn:hover {
      background: linear-gradient(135deg, #ffa726, #ff9800);
      transform: scale(1.05);
    }

    .recipe-craft-btn:disabled {
      background: rgba(100, 100, 100, 0.3);
      border-color: rgba(100, 100, 100, 0.5);
      cursor: not-allowed;
      opacity: 0.5;
    }

    /* ===== DEATH SCREEN ===== */
    #death-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle, rgba(139, 0, 0, 0.7), rgba(0, 0, 0, 0.95));
      z-index: 2000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.5s ease-out;
    }

    .death-title {
      font-size: 72px;
      font-weight: bold;
      color: #ff0000;
      text-transform: uppercase;
      letter-spacing: 8px;
      margin-bottom: 20px;
      text-shadow: 0 0 30px rgba(255, 0, 0, 0.8);
      animation: pulse 2s infinite;
    }

    .death-message {
      font-size: 24px;
      color: #fff;
      margin-bottom: 40px;
      text-align: center;
      max-width: 600px;
      line-height: 1.6;
    }

    .death-timer {
      font-size: 48px;
      font-weight: bold;
      color: #ffd700;
      margin-bottom: 20px;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.8; }
    }

    /* ===== VICTORY SCREEN ===== */
    #victory-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle, rgba(255, 215, 0, 0.3), rgba(0, 100, 0, 0.8), rgba(0, 0, 0, 0.95));
      z-index: 2000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      animation: fadeIn 1s ease-out;
    }

    .victory-title {
      font-size: 96px;
      font-weight: bold;
      color: #ffd700;
      text-transform: uppercase;
      letter-spacing: 12px;
      margin-bottom: 30px;
      text-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
      animation: victoryPulse 3s infinite;
    }

    .victory-message {
      font-size: 28px;
      color: #fff;
      margin-bottom: 20px;
      text-align: center;
      max-width: 700px;
      line-height: 1.8;
    }

    .victory-subtitle {
      font-size: 20px;
      color: #4caf50;
      margin-bottom: 10px;
      text-align: center;
    }

    @keyframes victoryPulse {
      0%, 100% { transform: scale(1) rotate(0deg); }
      25% { transform: scale(1.1) rotate(1deg); }
      75% { transform: scale(1.1) rotate(-1deg); }
    }

    /* ===== BOSS HEALTH BAR ===== */
    #boss-health-bar {
      position: fixed;
      top: 120px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, rgba(139, 0, 0, 0.95), rgba(80, 0, 0, 0.95));
      border: 3px solid #ff0000;
      border-radius: 10px;
      padding: 16px 24px;
      min-width: 500px;
      box-shadow: 0 8px 32px rgba(255, 0, 0, 0.5);
      z-index: 150;
      backdrop-filter: blur(8px);
    }

    .boss-name {
      font-size: 18px;
      font-weight: bold;
      color: #ffd700;
      text-align: center;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 2px;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
    }

    .boss-health-container {
      width: 100%;
      height: 28px;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 6px;
      overflow: hidden;
      border: 2px solid rgba(255, 0, 0, 0.5);
      position: relative;
    }

    .boss-health-fill {
      height: 100%;
      background: linear-gradient(90deg, #8b0000, #ff0000, #ff4444);
      transition: width 0.5s ease;
      box-shadow: inset 0 2px 8px rgba(255, 255, 255, 0.3);
      position: relative;
      overflow: hidden;
    }

    .boss-health-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: bossShine 2s infinite;
    }

    @keyframes bossShine {
      to { left: 200%; }
    }

    .boss-health-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 14px;
      font-weight: bold;
      color: #fff;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.9);
    }

    /* ===== TOOLTIP ===== */
    #tooltip {
      position: fixed;
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(30, 30, 30, 0.95));
      border: 2px solid rgba(255, 215, 0, 0.5);
      border-radius: 6px;
      padding: 12px 16px;
      z-index: 3000;
      pointer-events: none;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(8px);
      max-width: 300px;
    }

    .tooltip-title {
      font-size: 14px;
      font-weight: bold;
      color: #ffd700;
      margin-bottom: 6px;
    }

    .tooltip-description {
      font-size: 12px;
      color: #ccc;
      line-height: 1.4;
      margin-bottom: 6px;
    }

    .tooltip-type {
      font-size: 11px;
      color: #888;
      font-style: italic;
    }

    /* ===== CONTROLS HINT ===== */
    #controls-hint {
      position: fixed;
      bottom: 110px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      padding: 12px 20px;
      border-radius: 6px;
      font-size: 12px;
      color: #aaa;
      border: 1px solid rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(4px);
      display: flex;
      gap: 20px;
    }

    .control-hint {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .key {
      background: rgba(255, 255, 255, 0.15);
      color: #ffd700;
      font-weight: bold;
      padding: 4px 8px;
      border-radius: 4px;
      border: 1px solid rgba(255, 215, 0, 0.3);
      font-size: 11px;
    }

    /* ===== RESPONSIVE (Mobile) ===== */
    @media (max-width: 768px) {
      .stat-bar { min-width: 200px; }
      #game-info { min-width: 150px; }
      .hotbar-slot { width: 50px; height: 50px; }
      .hotbar-icon { font-size: 22px; }
      #inventory-panel, #crafting-panel { min-width: 95vw; padding: 16px; }
      .inventory-grid { grid-template-columns: repeat(4, 70px); }
      .inventory-slot { width: 70px; height: 70px; }
      #controls-hint { display: none; }
    }
  </style>
</head>
<body>
  <!-- Crosshair -->
  <div id="crosshair"></div>

  <!-- Top-Left HUD -->
  <div id="hud-top-left">
    <!-- Health Bar -->
    <div class="stat-bar">
      <div class="stat-label">
        <span>Health</span>
        <span class="stat-value" id="health-text">100/100</span>
      </div>
      <div class="bar-container">
        <div class="bar-fill health-bar" id="health-bar" style="width: 100%;"></div>
      </div>
    </div>

    <!-- Stamina Bar -->
    <div class="stat-bar">
      <div class="stat-label">
        <span>Stamina</span>
        <span class="stat-value" id="stamina-text">100/100</span>
      </div>
      <div class="bar-container">
        <div class="bar-fill stamina-bar" id="stamina-bar" style="width: 100%;"></div>
      </div>
    </div>

    <!-- XP Bar -->
    <div class="stat-bar">
      <div class="stat-label">
        <span>Level <span id="level-text">1</span></span>
        <span class="stat-value" id="xp-text">0/100</span>
      </div>
      <div class="bar-container">
        <div class="bar-fill xp-bar" id="xp-bar" style="width: 0%;"></div>
      </div>
    </div>
  </div>

  <!-- Top-Right Game Info -->
  <div id="game-info">
    <div class="night-indicator">
      Night <span class="night-number" id="night-number">1</span>/99
    </div>
    <div class="info-line">
      <span class="info-label">Phase</span>
      <span class="info-value" id="current-phase">Morning</span>
    </div>
    <div class="info-line">
      <span class="info-label">Inventory</span>
      <span class="info-value" id="inventory-count">0/24</span>
    </div>
  </div>

  <!-- Hotbar -->
  <div id="hotbar">
    <div class="hotbar-slot" data-slot="0">
      <div class="hotbar-number">1</div>
      <div class="hotbar-icon" id="hotbar-icon-0"></div>
      <div class="hotbar-quantity" id="hotbar-qty-0"></div>
    </div>
    <div class="hotbar-slot" data-slot="1">
      <div class="hotbar-number">2</div>
      <div class="hotbar-icon" id="hotbar-icon-1"></div>
      <div class="hotbar-quantity" id="hotbar-qty-1"></div>
    </div>
    <div class="hotbar-slot" data-slot="2">
      <div class="hotbar-number">3</div>
      <div class="hotbar-icon" id="hotbar-icon-2"></div>
      <div class="hotbar-quantity" id="hotbar-qty-2"></div>
    </div>
    <div class="hotbar-slot" data-slot="3">
      <div class="hotbar-number">4</div>
      <div class="hotbar-icon" id="hotbar-icon-3"></div>
      <div class="hotbar-quantity" id="hotbar-qty-3"></div>
    </div>
    <div class="hotbar-slot" data-slot="4">
      <div class="hotbar-number">5</div>
      <div class="hotbar-icon" id="hotbar-icon-4"></div>
      <div class="hotbar-quantity" id="hotbar-qty-4"></div>
    </div>
    <div class="hotbar-slot" data-slot="5">
      <div class="hotbar-number">6</div>
      <div class="hotbar-icon" id="hotbar-icon-5"></div>
      <div class="hotbar-quantity" id="hotbar-qty-5"></div>
    </div>
    <div class="hotbar-slot" data-slot="6">
      <div class="hotbar-number">7</div>
      <div class="hotbar-icon" id="hotbar-icon-6"></div>
      <div class="hotbar-quantity" id="hotbar-qty-6"></div>
    </div>
    <div class="hotbar-slot active" data-slot="7">
      <div class="hotbar-number">8</div>
      <div class="hotbar-icon" id="hotbar-icon-7"></div>
      <div class="hotbar-quantity" id="hotbar-qty-7"></div>
    </div>
  </div>

  <!-- Notifications Container -->
  <div id="notifications"></div>

  <!-- Inventory Panel (Hidden by default) -->
  <div id="inventory-panel" class="hidden pointer-events">
    <div class="inventory-header">
      <div class="inventory-title">üéí Inventory</div>
      <div class="inventory-close" onclick="UI.hideInventory()">√ó</div>
    </div>
    <div class="inventory-grid" id="inventory-grid">
      <!-- Generated dynamically -->
    </div>
  </div>

  <!-- Crafting Panel (Hidden by default) -->
  <div id="crafting-panel" class="hidden pointer-events">
    <div class="crafting-header">
      <div class="crafting-title">üî® Crafting</div>
      <div class="crafting-close" onclick="UI.hideCrafting()">√ó</div>
    </div>
    <div class="recipe-list" id="recipe-list">
      <!-- Generated dynamically -->
    </div>
  </div>

  <!-- Death Screen (Hidden by default) -->
  <div id="death-screen" class="hidden">
    <div class="death-title">üíÄ YOU DIED üíÄ</div>
    <div class="death-message">
      The darkness has consumed you...<br>
      You will respawn at the Safe Clearing.
    </div>
    <div class="death-timer" id="death-timer">5</div>
  </div>

  <!-- Victory Screen (Hidden by default) -->
  <div id="victory-screen" class="hidden">
    <div class="victory-title">üéâ VICTORY! üéâ</div>
    <div class="victory-message">
      You have survived all 99 nights in the cursed forest!
    </div>
    <div class="victory-subtitle">The curse is broken!</div>
    <div class="victory-subtitle">üå≤ The Ancient Grove has been restored! üå≤</div>
  </div>

  <!-- Boss Health Bar (Hidden by default) -->
  <div id="boss-health-bar" class="hidden">
    <div class="boss-name" id="boss-name">Ancient Guardian</div>
    <div class="boss-health-container">
      <div class="boss-health-fill" id="boss-health-fill" style="width: 100%;"></div>
      <div class="boss-health-text" id="boss-health-text">1000/1000</div>
    </div>
  </div>

  <!-- Tooltip (Hidden by default) -->
  <div id="tooltip" class="hidden">
    <div class="tooltip-title" id="tooltip-title">Item Name</div>
    <div class="tooltip-description" id="tooltip-description">Item description goes here.</div>
    <div class="tooltip-type" id="tooltip-type">Type: Resource</div>
  </div>

  <!-- Controls Hint -->
  <div id="controls-hint">
    <div class="control-hint">
      <span class="key">/inv</span>
      <span>Inventory</span>
    </div>
    <div class="control-hint">
      <span class="key">/craft</span>
      <span>Crafting</span>
    </div>
    <div class="control-hint">
      <span class="key">T</span>
      <span>Chat</span>
    </div>
    <div class="control-hint">
      <span class="key">/help</span>
      <span>Commands</span>
    </div>
  </div>

  <script>
    // ===== ITEM ICON MAPPING =====
    const ITEM_ICONS = {
      // Resources
      'wood': 'ü™µ',
      'stone': 'ü™®',
      'fiber': 'üåæ',
      'herb': 'üåø',
      'iron_ore': '‚õèÔ∏è',
      'crystal': 'üíé',

      // Consumables
      'healing_potion': 'üß™',
      'stamina_potion': '‚öóÔ∏è',

      // Structures
      'torch': 'üî•',
      'campfire': 'üèïÔ∏è',
      'ward_totem': 'üóø',

      // Tools
      'wooden_axe': 'ü™ì',
      'stone_axe': 'ü™ì',
      'wooden_pickaxe': '‚õèÔ∏è',
      'stone_pickaxe': '‚õèÔ∏è',

      // Weapons
      'wooden_sword': 'üó°Ô∏è',
      'stone_sword': '‚öîÔ∏è',

      // Default
      'default': 'üì¶'
    };

    // ===== GAME STATE =====
    const UI = {
      // Player stats
      health: 100,
      maxHealth: 100,
      stamina: 100,
      maxStamina: 100,
      level: 1,
      xp: 0,
      xpForNext: 100,

      // Game info
      nightNumber: 1,
      currentPhase: 'morning',
      inventorySlots: 0,

      // Inventory & crafting
      inventory: [],
      recipes: [],

      // Boss
      bossActive: false,
      bossHealth: 0,
      bossMaxHealth: 0,
      bossName: '',

      // Notifications queue
      notifications: [],

      // ===== UPDATE FUNCTIONS =====
      updateHealth(current, max) {
        this.health = current;
        this.maxHealth = max;
        const percent = Math.max(0, Math.min(100, (current / max) * 100));
        document.getElementById('health-bar').style.width = percent + '%';
        document.getElementById('health-text').textContent = `${Math.round(current)}/${Math.round(max)}`;
      },

      updateStamina(current, max) {
        this.stamina = current;
        this.maxStamina = max;
        const percent = Math.max(0, Math.min(100, (current / max) * 100));
        document.getElementById('stamina-bar').style.width = percent + '%';
        document.getElementById('stamina-text').textContent = `${Math.round(current)}/${Math.round(max)}`;
      },

      updateLevel(level, xp, xpForNext) {
        this.level = level;
        this.xp = xp;
        this.xpForNext = xpForNext || (level * 100);
        const percent = Math.max(0, Math.min(100, (xp / this.xpForNext) * 100));
        document.getElementById('level-text').textContent = level;
        document.getElementById('xp-bar').style.width = percent + '%';
        document.getElementById('xp-text').textContent = `${Math.round(xp)}/${Math.round(this.xpForNext)}`;
      },

      updateGameInfo(nightNumber, phase, inventorySlots) {
        if (nightNumber !== undefined) {
          this.nightNumber = nightNumber;
          document.getElementById('night-number').textContent = nightNumber;
        }
        if (phase !== undefined) {
          this.currentPhase = phase;
          document.getElementById('current-phase').textContent =
            phase.charAt(0).toUpperCase() + phase.slice(1);
        }
        if (inventorySlots !== undefined) {
          this.inventorySlots = inventorySlots;
          document.getElementById('inventory-count').textContent = `${inventorySlots}/24`;
        }
      },

      // ===== HOTBAR =====
      updateHotbar(items) {
        for (let i = 0; i < 8; i++) {
          const slot = document.querySelector(`[data-slot="${i}"]`);
          const icon = document.getElementById(`hotbar-icon-${i}`);
          const qty = document.getElementById(`hotbar-qty-${i}`);

          if (items[i] && items[i].id) {
            const itemIcon = ITEM_ICONS[items[i].id] || ITEM_ICONS.default;
            icon.textContent = itemIcon;
            qty.textContent = items[i].quantity > 1 ? items[i].quantity : '';
            slot.classList.add('has-item');
          } else {
            icon.textContent = '';
            qty.textContent = '';
            slot.classList.remove('has-item');
          }
        }
      },

      // ===== NOTIFICATIONS =====
      showNotification(title, message, type = 'info', duration = 5000) {
        const container = document.getElementById('notifications');
        const notif = document.createElement('div');
        notif.className = `notification ${type}`;

        const titleEl = document.createElement('div');
        titleEl.className = 'notification-title';
        titleEl.textContent = title;

        const messageEl = document.createElement('div');
        messageEl.className = 'notification-message';
        messageEl.textContent = message;

        notif.appendChild(titleEl);
        notif.appendChild(messageEl);
        container.appendChild(notif);

        // Auto-remove after duration
        setTimeout(() => {
          notif.style.animation = 'slideOut 0.3s ease-out';
          setTimeout(() => notif.remove(), 300);
        }, duration);
      },

      // ===== INVENTORY =====
      showInventory() {
        console.log('[UI] showInventory() called');
        const panel = document.getElementById('inventory-panel');
        console.log('[UI] Inventory panel element:', panel);
        console.log('[UI] Panel classes before:', panel.className);
        panel.classList.remove('hidden');
        console.log('[UI] Panel classes after:', panel.className);
        this.renderInventory();
      },

      hideInventory() {
        document.getElementById('inventory-panel').classList.add('hidden');
      },

      renderInventory() {
        const grid = document.getElementById('inventory-grid');
        grid.innerHTML = '';

        // Create 24 slots
        for (let i = 0; i < 24; i++) {
          const slot = document.createElement('div');
          slot.className = 'inventory-slot';

          const item = this.inventory[i];
          if (item && item.id) {
            slot.classList.add('has-item');

            const icon = document.createElement('div');
            icon.className = 'inventory-slot-icon';
            icon.textContent = ITEM_ICONS[item.id] || ITEM_ICONS.default;

            const name = document.createElement('div');
            name.className = 'inventory-slot-name';
            name.textContent = item.name || item.id;

            const qty = document.createElement('div');
            qty.className = 'inventory-slot-quantity';
            qty.textContent = item.quantity > 1 ? item.quantity : '';

            slot.appendChild(icon);
            slot.appendChild(name);
            slot.appendChild(qty);

            // Tooltip on hover
            slot.addEventListener('mouseenter', (e) => {
              this.showTooltip(item, e.pageX, e.pageY);
            });
            slot.addEventListener('mouseleave', () => {
              this.hideTooltip();
            });
          }

          grid.appendChild(slot);
        }
      },

      updateInventory(items) {
        this.inventory = items;
        if (!document.getElementById('inventory-panel').classList.contains('hidden')) {
          this.renderInventory();
        }
      },

      // ===== CRAFTING =====
      showCrafting() {
        document.getElementById('crafting-panel').classList.remove('hidden');
        this.renderCrafting();
      },

      hideCrafting() {
        document.getElementById('crafting-panel').classList.add('hidden');
      },

      renderCrafting() {
        const list = document.getElementById('recipe-list');
        list.innerHTML = '';

        this.recipes.forEach((recipe) => {
          const item = document.createElement('div');
          item.className = 'recipe-item';
          if (recipe.canCraft) item.classList.add('craftable');

          const icon = document.createElement('div');
          icon.className = 'recipe-icon';
          icon.textContent = ITEM_ICONS[recipe.result] || ITEM_ICONS.default;

          const info = document.createElement('div');
          info.className = 'recipe-info';

          const name = document.createElement('div');
          name.className = 'recipe-name';
          name.textContent = recipe.name;

          const requirements = document.createElement('div');
          requirements.className = 'recipe-requirements';

          recipe.requirements.forEach((req) => {
            const reqEl = document.createElement('div');
            reqEl.className = `requirement ${req.has ? 'has' : 'missing'}`;
            reqEl.textContent = `${ITEM_ICONS[req.id] || '‚Ä¢'} ${req.name}: ${req.current}/${req.needed}`;
            requirements.appendChild(reqEl);
          });

          info.appendChild(name);
          info.appendChild(requirements);

          const craftBtn = document.createElement('button');
          craftBtn.className = 'recipe-craft-btn';
          craftBtn.textContent = 'Craft';
          craftBtn.disabled = !recipe.canCraft;
          craftBtn.onclick = () => this.craftItem(recipe.result);

          item.appendChild(icon);
          item.appendChild(info);
          item.appendChild(craftBtn);
          list.appendChild(item);
        });
      },

      updateRecipes(recipes) {
        this.recipes = recipes;
        if (!document.getElementById('crafting-panel').classList.contains('hidden')) {
          this.renderCrafting();
        }
      },

      craftItem(recipeId) {
        // Send craft request to server
        window.parent.postMessage({ type: 'craft', recipeId }, '*');
      },

      // ===== BOSS =====
      showBoss(name, health, maxHealth) {
        this.bossActive = true;
        this.bossName = name;
        this.bossHealth = health;
        this.bossMaxHealth = maxHealth;
        document.getElementById('boss-name').textContent = name;
        this.updateBossHealth(health, maxHealth);
        document.getElementById('boss-health-bar').classList.remove('hidden');
      },

      updateBossHealth(health, maxHealth) {
        this.bossHealth = health;
        this.bossMaxHealth = maxHealth;
        const percent = Math.max(0, Math.min(100, (health / maxHealth) * 100));
        document.getElementById('boss-health-fill').style.width = percent + '%';
        document.getElementById('boss-health-text').textContent = `${Math.round(health)}/${Math.round(maxHealth)}`;
      },

      hideBoss() {
        this.bossActive = false;
        document.getElementById('boss-health-bar').classList.add('hidden');
      },

      // ===== DEATH SCREEN =====
      showDeath(respawnTime = 5) {
        const screen = document.getElementById('death-screen');
        screen.classList.remove('hidden');

        let countdown = respawnTime;
        const timer = document.getElementById('death-timer');
        timer.textContent = countdown;

        const interval = setInterval(() => {
          countdown--;
          if (countdown > 0) {
            timer.textContent = countdown;
          } else {
            clearInterval(interval);
            screen.classList.add('hidden');
          }
        }, 1000);
      },

      // ===== VICTORY SCREEN =====
      showVictory() {
        document.getElementById('victory-screen').classList.remove('hidden');
      },

      // ===== TOOLTIP =====
      showTooltip(item, x, y) {
        const tooltip = document.getElementById('tooltip');
        document.getElementById('tooltip-title').textContent = item.name || item.id;
        document.getElementById('tooltip-description').textContent = item.description || 'No description available.';
        document.getElementById('tooltip-type').textContent = `Type: ${item.type || 'Unknown'}`;

        tooltip.style.left = (x + 15) + 'px';
        tooltip.style.top = (y + 15) + 'px';
        tooltip.classList.remove('hidden');
      },

      hideTooltip() {
        document.getElementById('tooltip').classList.add('hidden');
      },
    };

    // ===== MESSAGE HANDLER =====
    // Hytopia SDK uses window message events
    window.addEventListener('message', (event) => {
      const data = event.data;

      // Debug: Log received data with type
      if (data.type) {
        console.log(`[UI] Received: ${data.type}`, data);
      } else {
        console.log('[UI] Received data:', data);
      }

      // Player stats update
      if (data.type === 'player_stats') {
        UI.updateHealth(data.health, data.maxHealth || 100);
        UI.updateStamina(data.stamina, data.maxStamina || 100);
        UI.updateLevel(data.level, data.xp, data.xpForNext);
        UI.updateGameInfo(undefined, undefined, data.inventorySlots);
      }

      // Game info update
      if (data.type === 'game_info') {
        UI.updateGameInfo(data.night, data.phase, data.inventorySlots);
      }

      // Hotbar update
      if (data.type === 'hotbar') {
        UI.updateHotbar(data.items);
      }

      // Inventory update
      if (data.type === 'inventory') {
        UI.updateInventory(data.items);
      }

      // Recipes update
      if (data.type === 'recipes') {
        UI.updateRecipes(data.recipes);
      }

      // Show inventory
      if (data.type === 'show_inventory') {
        UI.showInventory();
      }

      // Show crafting
      if (data.type === 'show_crafting') {
        UI.showCrafting();
      }

      // Notification
      if (data.type === 'notification') {
        UI.showNotification(data.title, data.message, data.notifType || 'info', data.duration);
      }

      // Boss
      if (data.type === 'boss_spawn') {
        UI.showBoss(data.name, data.health, data.maxHealth);
      }

      if (data.type === 'boss_health') {
        UI.updateBossHealth(data.health, data.maxHealth);
      }

      if (data.type === 'boss_defeated') {
        UI.hideBoss();
      }

      // Death
      if (data.type === 'death') {
        UI.showDeath(data.respawnTime || 5);
      }

      // Victory
      if (data.type === 'victory') {
        UI.showVictory();
      }
    });

    // ===== KEYBOARD SHORTCUTS =====
    document.addEventListener('keydown', (e) => {
      // I key - Toggle inventory
      if (e.key === 'i' || e.key === 'I') {
        const panel = document.getElementById('inventory-panel');
        if (panel.classList.contains('hidden')) {
          window.parent.postMessage({ type: 'open_inventory' }, '*');
        } else {
          UI.hideInventory();
        }
      }

      // C key - Toggle crafting
      if (e.key === 'c' || e.key === 'C') {
        const panel = document.getElementById('crafting-panel');
        if (panel.classList.contains('hidden')) {
          window.parent.postMessage({ type: 'open_crafting' }, '*');
        } else {
          UI.hideCrafting();
        }
      }

      // ESC key - Close panels
      if (e.key === 'Escape') {
        UI.hideInventory();
        UI.hideCrafting();
      }
    });

    console.log('üå≤ 99 Nights UI System Loaded');
    console.log('‚ú® Enhanced UI v2.0 - Full Feature Set');
  </script>
</body>
</html>
